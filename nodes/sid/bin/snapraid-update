#!/usr/bin/env fish

curl -s https://api.github.com/repos/ironicbadger/docker-snapraid/actions/artifacts |\
string match -r "https://.*artifacts.*zip" | sed 1q |\
xargs curl -H "Accept: application/vnd.github+json" -H "Authorization: Bearer $(sops -d --extract "['github_public_repo_token']" ~/secrets.yaml)" -H "X-GitHub-Api-Version: 2022-11-28" -Lo ~/snapraid.zip

unzip ~/snapraid.zip
rm ~/snapraid.zip
sudo apt install ~/snapraid-from-source.deb -y
rm ~/snapraid-from-source.deb
sudo apt-mark hold snapraid
snapraid --version